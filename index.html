<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEET Biology Complete Platform</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Poppins', sans-serif; background: #0f1117; min-height: 100vh; padding: 1.5rem; color: #e2e8f0; }
        .container { max-width: 1400px; margin: 0 auto; }
        h1 { text-align: center; color: #f1f5f9; font-size: 2.8rem; margin-bottom: 0.5rem; font-weight: 700; }
        .subtitle { text-align: center; color: #94a3b8; font-size: 1.1rem; margin-bottom: 2.5rem; }
        .topic-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1.5rem; margin-bottom: 2rem; }
        .topic-card { background: #1e2130; padding: 2rem; border-radius: 16px; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 6px rgba(0,0,0,0.3); border: 2px solid transparent; }
        .topic-card:hover { transform: translateY(-8px); box-shadow: 0 12px 24px rgba(0,0,0,0.5); }
        .topic-icon { font-size: 2.5rem; margin-bottom: 0.8rem; }
        .topic-card h3 { font-size: 1.3rem; margin-bottom: 0.5rem; font-weight: 700; }
        .topic-card p { font-size: 0.95rem; opacity: 0.8; }

        .topic-diversity { border-color: #22c55e; background: #0d2818; }
        .topic-diversity h3 { color: #4ade80; }
        .topic-diversity p { color: #86efac; }
        .topic-diversity:hover { background: #14532d; }

        .topic-structural { border-color: #3b82f6; background: #0d1a2e; }
        .topic-structural h3 { color: #60a5fa; }
        .topic-structural p { color: #93c5fd; }
        .topic-structural:hover { background: #1e3a5f; }

        .topic-cell { border-color: #a855f7; background: #1a0d2e; }
        .topic-cell h3 { color: #c084fc; }
        .topic-cell p { color: #d8b4fe; }
        .topic-cell:hover { background: #2d1b4e; }

        .topic-plant-phys { border-color: #10b981; background: #0a2018; }
        .topic-plant-phys h3 { color: #34d399; }
        .topic-plant-phys p { color: #6ee7b7; }
        .topic-plant-phys:hover { background: #134e36; }

        .topic-human-phys { border-color: #f59e0b; background: #2a1a05; }
        .topic-human-phys h3 { color: #fbbf24; }
        .topic-human-phys p { color: #fcd34d; }
        .topic-human-phys:hover { background: #451f05; }

        .topic-reproduction { border-color: #ec4899; background: #2a0d1a; }
        .topic-reproduction h3 { color: #f472b6; }
        .topic-reproduction p { color: #fbcfe8; }
        .topic-reproduction:hover { background: #4a1030; }

        .topic-genetics { border-color: #6366f1; background: #0f0d2e; }
        .topic-genetics h3 { color: #818cf8; }
        .topic-genetics p { color: #a5b4fc; }
        .topic-genetics:hover { background: #1e1b4b; }

        .topic-welfare { border-color: #14b8a6; background: #0a2220; }
        .topic-welfare h3 { color: #2dd4bf; }
        .topic-welfare p { color: #99f6e4; }
        .topic-welfare:hover { background: #134e4a; }

        .topic-biotech { border-color: #f97316; background: #2a1005; }
        .topic-biotech h3 { color: #fb923c; }
        .topic-biotech p { color: #fed7aa; }
        .topic-biotech:hover { background: #431407; }

        .topic-ecology { border-color: #84cc16; background: #162208; }
        .topic-ecology h3 { color: #a3e635; }
        .topic-ecology p { color: #d9f99d; }
        .topic-ecology:hover { background: #1a2e06; }

        .topic-custom { background: linear-gradient(135deg, #312e81 0%, #4c1d95 100%); border-color: #818cf8; }
        .topic-custom h3 { color: #c7d2fe; }
        .topic-custom p { color: #a5b4fc; }
        .topic-custom:hover { transform: translateY(-8px) scale(1.02); background: linear-gradient(135deg, #3730a3 0%, #5b21b6 100%); }
        .chapter-page { text-align: center; }
        .chapter-page h2 { color: #1e293b; font-size: 2rem; margin-bottom: 2rem; }
        .chapter-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 1.2rem; margin-top: 1.5rem; }
        .chapter-card { background: white; padding: 1.8rem; border: 2px solid #e2e8f0; border-radius: 12px; cursor: pointer; transition: all 0.3s; }
        .chapter-card:hover { border-color: #3b82f6; transform: translateY(-5px); box-shadow: 0 8px 16px rgba(59,130,246,0.2); }
        .chapter-card h3 { font-size: 1.15rem; color: #1e293b; font-weight: 600; margin-bottom: 0.3rem; }
        .chapter-card p { color: #64748b; font-size: 0.9rem; }
        .chapter-card.no-questions { opacity: 0.5; cursor: not-allowed; }
        .chapter-card.no-questions:hover { transform: none; box-shadow: none; border-color: #e2e8f0; }
        .controls-page { max-width: 700px; margin: 0 auto; text-align: center; }
        .controls-page h2 { color: #1e293b; font-size: 2rem; margin-bottom: 2rem; }
        .input-section { background: white; padding: 2rem; border-radius: 16px; margin-bottom: 1.5rem; box-shadow: 0 4px 6px rgba(0,0,0,0.07); }
        .input-section h3 { font-size: 1.3rem; color: #1e293b; margin-bottom: 1.2rem; }
        .input-group { display: flex; flex-direction: column; gap: 1rem; align-items: center; }
        .input-group label { font-size: 1.05rem; color: #475569; font-weight: 500; }
        .input-group input[type="range"] { width: 100%; max-width: 400px; height: 8px; accent-color: #3b82f6; }
        .value-display { font-size: 2rem; font-weight: 700; color: #60a5fa; margin: 0.5rem 0; }
        .custom-builder { max-width: 1000px; margin: 0 auto; }
        .builder-section { background: #1e2130; padding: 1.8rem; border-radius: 12px; margin-bottom: 1.5rem; box-shadow: 0 2px 4px rgba(0,0,0,0.3); border: 1px solid #2d3348; }
        .builder-section h3 { font-size: 1.4rem; color: #f1f5f9; margin-bottom: 1.2rem; padding-bottom: 0.8rem; border-bottom: 2px solid #2d3348; }
        .chapter-checkbox { display: flex; align-items: center; padding: 0.9rem 1rem; margin-bottom: 0.4rem; background: #151824; border-radius: 8px; cursor: pointer; transition: all 0.2s; }
        .chapter-checkbox:hover { background: #1a2540; }
        .chapter-checkbox input { width: 18px; height: 18px; margin-right: 0.9rem; cursor: pointer; accent-color: #3b82f6; }
        .chapter-checkbox label { flex: 1; cursor: pointer; color: #cbd5e1; font-size: 1rem; }
        .selected-count { margin-top: 1.5rem; padding: 1.2rem; background: #1e3a5f; border-radius: 10px; font-weight: 600; color: #93c5fd; font-size: 1.1rem; border: 1px solid #3b82f6; }
        .btn { padding: 0.9rem 2rem; font-size: 1.05rem; font-weight: 600; border: none; border-radius: 10px; cursor: pointer; transition: all 0.3s; }
        .btn-primary { background: #3b82f6; color: white; }
        .btn-primary:hover:not(:disabled) { background: #2563eb; transform: translateY(-2px); box-shadow: 0 6px 12px rgba(59,130,246,0.4); }
        .btn-primary:disabled { background: #374151; color: #6b7280; cursor: not-allowed; }
        .btn-back { background: #374151; color: #cbd5e1; margin-top: 1.5rem; }
        .btn-back:hover { background: #4b5563; }
        .quiz-container { max-width: 900px; margin: 0 auto; }
        .quiz-header { background: #1e2130; padding: 1.5rem; border-radius: 12px; margin-bottom: 1.5rem; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem; box-shadow: 0 2px 4px rgba(0,0,0,0.3); border: 1px solid #2d3348; }
        .quiz-info { font-size: 1.05rem; color: #f1f5f9; font-weight: 600; }
        .timer-display { font-size: 1.3rem; font-weight: 700; color: #f87171; }
        .score-display { font-size: 1.2rem; font-weight: 700; color: #f1f5f9; }
        .question-card { background: #1e2130; padding: 2.5rem; border-radius: 16px; box-shadow: 0 4px 8px rgba(0,0,0,0.3); border: 1px solid #2d3348; }
        .question-text { font-size: 1.35rem; color: #f1f5f9; margin-bottom: 2rem; line-height: 1.7; font-weight: 500; }
        .options { display: flex; flex-direction: column; gap: 1rem; }
        .option { padding: 1.2rem 1.5rem; background: #151824; border: 2px solid #2d3348; border-radius: 10px; cursor: pointer; transition: all 0.3s; font-size: 1.05rem; color: #cbd5e1; }
        .option:hover { border-color: #94a3b8; transform: translateX(5px); background: #1e2540; }
        .option.selected { border-color: #3b82f6; background: #1e3a5f; color: #93c5fd; }
        .option.correct { background: #14532d !important; color: #4ade80 !important; border-color: #22c55e !important; }
        .option.incorrect { background: #7f1d1d !important; color: #fca5a5 !important; border-color: #ef4444 !important; }
        .option.disabled { pointer-events: none; opacity: 0.85; }
        .explanation { margin-top: 1.5rem; padding: 1.5rem; background: #292112; border-left: 4px solid #f59e0b; border-radius: 8px; line-height: 1.7; color: #fde68a; }
        .quiz-buttons { display: flex; gap: 1rem; margin-top: 2rem; }
        .btn-submit { flex: 1; background: #3b82f6; color: white; padding: 1rem; font-size: 1.1rem; }
        .btn-next { flex: 1; background: #16a34a; color: white; padding: 1rem; font-size: 1.1rem; }
        .btn-prev { flex: 1; background: #374151; color: #cbd5e1; padding: 1rem; font-size: 1.1rem; }
        .btn-prev:hover { background: #4b5563; }
        .results-container { text-align: center; background: #1e2130; padding: 3rem 2rem; border-radius: 16px; box-shadow: 0 8px 16px rgba(0,0,0,0.4); border: 1px solid #2d3348; }
        .results-container h2 { font-size: 2.5rem; color: #f1f5f9; margin-bottom: 1.5rem; }
        .final-score { font-size: 4.5rem; font-weight: 800; margin: 2rem 0; }
        .final-score.excellent { color: #4ade80; }
        .final-score.good { color: #60a5fa; }
        .final-score.average { color: #fbbf24; }
        .final-score.poor { color: #f87171; }
        .score-breakdown { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 1.5rem; margin: 2rem 0; }
        .score-item { padding: 1.5rem; background: #151824; border-radius: 12px; border: 1px solid #2d3348; }
        .score-item h3 { font-size: 0.9rem; color: #94a3b8; margin-bottom: 0.5rem; text-transform: uppercase; }
        .score-item p { font-size: 2rem; font-weight: 700; color: #f1f5f9; }
        .q-timer-bar-wrap { background: #151824; border-radius: 999px; height: 8px; margin-bottom: 1.5rem; overflow: hidden; }
        .q-timer-bar { height: 100%; border-radius: 999px; background: #3b82f6; transition: width 1s linear, background 0.5s; }
        .q-timer-bar.warning { background: #f59e0b; }
        .q-timer-bar.danger { background: #ef4444; }
        .q-timer-label { font-size: 0.9rem; color: #64748b; margin-bottom: 0.4rem; display: flex; justify-content: space-between; }
        .paused-banner { background: #292112; border: 2px solid #f59e0b; border-radius: 10px; padding: 0.8rem 1.2rem; text-align: center; font-weight: 600; color: #fbbf24; margin-bottom: 1rem; font-size: 1rem; }
        .review-panel { background: #1e2130; border-radius: 16px; box-shadow: 0 4px 8px rgba(0,0,0,0.3); padding: 2rem; margin-top: 2rem; border: 1px solid #2d3348; }
        .review-panel h3 { color: #f1f5f9; font-size: 1.3rem; margin-bottom: 1.2rem; border-bottom: 2px solid #2d3348; padding-bottom: 0.8rem; }
        .review-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(52px, 1fr)); gap: 0.6rem; }
        .review-btn { width: 52px; height: 52px; border-radius: 10px; border: 2px solid #2d3348; background: #151824; font-size: 0.9rem; font-weight: 700; cursor: pointer; transition: all 0.2s; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 1px; color: #94a3b8; }
        .review-btn:hover { transform: scale(1.08); }
        .review-btn .q-num { font-size: 0.85rem; }
        .review-btn .q-time { font-size: 0.65rem; font-weight: 400; color: #64748b; }
        .review-btn.correct-q { background: #14532d; border-color: #22c55e; color: #4ade80; }
        .review-btn.incorrect-q { background: #7f1d1d; border-color: #ef4444; color: #fca5a5; }
        .review-btn.skipped-q { background: #292112; border-color: #f59e0b; color: #fbbf24; }
        .review-btn.current-q { border-color: #60a5fa; box-shadow: 0 0 0 3px rgba(96,165,250,0.4); }
        .review-btn.reviewing { background: #2d1b4e; border-color: #a855f7; color: #d8b4fe; }
        .subject-heading { display: flex; align-items: center; gap: 0.8rem; font-size: 1.8rem; font-weight: 700; color: #4ade80; margin: 1rem 0 1.2rem 0; padding-bottom: 0.6rem; border-bottom: 3px solid #22c55e; }
        .subject-heading.subject-chemistry { color: #60a5fa; border-bottom-color: #3b82f6; margin-top: 2.5rem; }
        .subject-icon { font-size: 1.8rem; }
        .topic-card.topic-coming-soon { border-color: #374151; background: #151824; opacity: 0.6; cursor: default; }
        .topic-card.topic-coming-soon h3 { color: #94a3b8; }
        .topic-card.topic-coming-soon p { color: #64748b; }
        .topic-card.topic-coming-soon:hover { transform: none; box-shadow: none; }
        .hidden { display: none !important; }
        .review-filter-btn { padding: 0.6rem 1.4rem; border-radius: 8px; border: 2px solid #2d3348; background: #1e2130; color: #94a3b8; font-size: 0.95rem; font-weight: 600; cursor: pointer; transition: all 0.2s; font-family: 'Poppins', sans-serif; }
        .review-filter-btn:hover { border-color: #60a5fa; color: #f1f5f9; }
        .review-filter-btn.active { background: #1e3a5f; border-color: #3b82f6; color: #60a5fa; }
        .review-q-card { background: #1e2130; border-radius: 14px; padding: 1.8rem; margin-bottom: 1.2rem; border: 2px solid #2d3348; }
        .review-q-card.review-correct { border-color: #22c55e; }
        .review-q-card.review-incorrect { border-color: #ef4444; }
        .review-q-card.review-unanswered { border-color: #f59e0b; }
        .review-q-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
        .review-q-num { font-size: 0.9rem; font-weight: 600; color: #94a3b8; }
        .review-q-badge { font-size: 0.8rem; font-weight: 700; padding: 0.3rem 0.8rem; border-radius: 999px; }
        .badge-correct { background: #14532d; color: #4ade80; }
        .badge-incorrect { background: #7f1d1d; color: #fca5a5; }
        .badge-unanswered { background: #292112; color: #fbbf24; }
        .review-q-text { font-size: 1.05rem; color: #f1f5f9; font-weight: 500; line-height: 1.7; margin-bottom: 1.2rem; white-space: pre-line; }
        .review-options { display: flex; flex-direction: column; gap: 0.6rem; margin-bottom: 1.2rem; }
        .review-option { padding: 0.8rem 1.2rem; border-radius: 8px; font-size: 0.95rem; border: 2px solid #2d3348; background: #151824; color: #cbd5e1; }
        .review-option.review-opt-correct { background: #14532d; border-color: #22c55e; color: #4ade80; font-weight: 600; }
        .review-option.review-opt-selected-wrong { background: #7f1d1d; border-color: #ef4444; color: #fca5a5; }
        .review-explanation { padding: 1rem 1.2rem; background: #292112; border-left: 4px solid #f59e0b; border-radius: 8px; font-size: 0.95rem; color: #fde68a; line-height: 1.7; }

        /* Per-question timer */
        .q-timer-bar-wrap { background: #e2e8f0; border-radius: 999px; height: 8px; margin-bottom: 1.5rem; overflow: hidden; }
        .q-timer-bar { height: 100%; border-radius: 999px; background: #3b82f6; transition: width 1s linear, background 0.5s; }
        .q-timer-bar.warning { background: #f59e0b; }
        .q-timer-bar.danger { background: #ef4444; }
        .q-timer-label { font-size: 0.9rem; color: #64748b; margin-bottom: 0.4rem; display: flex; justify-content: space-between; }

        /* Paused banner */
        .paused-banner { background: #fef3c7; border: 2px solid #f59e0b; border-radius: 10px; padding: 0.8rem 1.2rem; text-align: center; font-weight: 600; color: #92400e; margin-bottom: 1rem; font-size: 1rem; }

        /* Review panel */
        .review-panel { background: white; border-radius: 16px; box-shadow: 0 4px 8px rgba(0,0,0,0.08); padding: 2rem; margin-top: 2rem; }
        .review-panel h3 { color: #1e293b; font-size: 1.3rem; margin-bottom: 1.2rem; border-bottom: 2px solid #e2e8f0; padding-bottom: 0.8rem; }
        .review-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(52px, 1fr)); gap: 0.6rem; }
        .review-btn { width: 52px; height: 52px; border-radius: 10px; border: 2px solid #e2e8f0; background: #f8fafc; font-size: 0.9rem; font-weight: 700; cursor: pointer; transition: all 0.2s; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 1px; }
        .review-btn:hover { transform: scale(1.08); }
        .review-btn .q-num { font-size: 0.85rem; }
        .review-btn .q-time { font-size: 0.65rem; font-weight: 400; color: #94a3b8; }
        .review-btn.correct-q { background: #dcfce7; border-color: #22c55e; color: #15803d; }
        .review-btn.incorrect-q { background: #fee2e2; border-color: #ef4444; color: #b91c1c; }
        .review-btn.skipped-q { background: #fef3c7; border-color: #f59e0b; color: #92400e; }
        .review-btn.current-q { border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59,130,246,0.3); }
        .review-btn.reviewing { background: #ede9fe; border-color: #7c3aed; color: #5b21b6; }

        /* Quiz nav buttons */
        .btn-prev { flex: 1; background: #64748b; color: white; padding: 1rem; font-size: 1.1rem; }
        .btn-prev:hover { background: #475569; }

        @media (max-width: 768px) {
            h1 { font-size: 2rem; }
            .topic-grid, .chapter-grid { grid-template-columns: 1fr; }
            .question-card { padding: 1.5rem; }
            .question-text { font-size: 1.2rem; }
            .quiz-buttons { flex-direction: column; }
            .review-grid { grid-template-columns: repeat(auto-fill, minmax(44px, 1fr)); }
        }
    </style>
</head>
<body>
<div class="container">

    <!-- HOMEPAGE -->
    <div id="homePage">
        <h1>üìö NEET Mastery</h1>
        <p class="subtitle">Complete NCERT Coverage ‚Ä¢ Smart Practice ‚Ä¢ Track Your Progress</p>

        <!-- BIOLOGY SECTION -->
        <div class="subject-heading">
            <span class="subject-icon">üß¨</span>
            <span>Biology</span>
        </div>
        <div class="topic-grid">
            <div class="topic-card topic-diversity" onclick="showChapters('diversity')">
                <div class="topic-icon">üåç</div>
                <h3>Diversity in Living World</h3>
                <p>4 Chapters ‚Ä¢ 200 Questions</p>
            </div>
            <div class="topic-card topic-structural" onclick="showChapters('structural')">
                <div class="topic-icon">üî¨</div>
                <h3>Structural Organisation</h3>
                <p>3 Chapters ‚Ä¢ 150 Questions</p>
            </div>
            <div class="topic-card topic-cell" onclick="showChapters('cell')">
                <div class="topic-icon">üß´</div>
                <h3>Cell Structure & Function</h3>
                <p>3 Chapters ‚Ä¢ 150 Questions</p>
            </div>
            <div class="topic-card topic-plant-phys" onclick="showChapters('plant_physiology')">
                <div class="topic-icon">üå±</div>
                <h3>Plant Physiology</h3>
                <p>3 Chapters ‚Ä¢ 150 Questions</p>
            </div>
            <div class="topic-card topic-human-phys" onclick="showChapters('human_physiology')">
                <div class="topic-icon">ü´Ä</div>
                <h3>Human Physiology</h3>
                <p>6 Chapters ‚Ä¢ 300 Questions</p>
            </div>
            <div class="topic-card topic-reproduction" onclick="showChapters('reproduction')">
                <div class="topic-icon">üå∏</div>
                <h3>Reproduction</h3>
                <p>3 Chapters ‚Ä¢ 150 Questions</p>
            </div>
            <div class="topic-card topic-genetics" onclick="showChapters('genetics')">
                <div class="topic-icon">üß¨</div>
                <h3>Genetics & Evolution</h3>
                <p>3 Chapters ‚Ä¢ 150 Questions</p>
            </div>
            <div class="topic-card topic-welfare" onclick="showChapters('welfare')">
                <div class="topic-icon">üè•</div>
                <h3>Biology & Human Welfare</h3>
                <p>2 Chapters ‚Ä¢ 100 Questions</p>
            </div>
            <div class="topic-card topic-biotech" onclick="showChapters('biotech')">
                <div class="topic-icon">‚öóÔ∏è</div>
                <h3>Biotechnology</h3>
                <p>2 Chapters ‚Ä¢ 100 Questions</p>
            </div>
            <div class="topic-card topic-ecology" onclick="showChapters('ecology')">
                <div class="topic-icon">üåø</div>
                <h3>Ecology</h3>
                <p>3 Chapters ‚Ä¢ 150 Questions</p>
            </div>
            <div class="topic-card topic-custom" onclick="showCustomBuilder()">
                <div class="topic-icon">‚ö°</div>
                <h3>Custom Test</h3>
                <p>Mix any chapters ‚Ä¢ Personalized practice</p>
            </div>
        </div>

        <!-- CHEMISTRY SECTION -->
        <div class="subject-heading subject-chemistry">
            <span class="subject-icon">‚öóÔ∏è</span>
            <span>Chemistry</span>
        </div>
        <div class="topic-grid">
            <div class="topic-card topic-coming-soon">
                <div class="topic-icon">üîú</div>
                <h3>Coming Soon</h3>
                <p>Chemistry chapters will be added here</p>
            </div>
        </div>

    </div>

    <!-- CHAPTER SELECTION -->
    <div id="chapterPage" class="chapter-page hidden">
        <h2 id="chapterTitle">Select Chapter</h2>
        <div class="chapter-grid" id="chapterGrid"></div>
        <div style="text-align:center"><button class="btn btn-back" onclick="backToHome()">‚Üê Back to Home</button></div>
    </div>

    <!-- CONTROLS -->
    <div id="controlsPage" class="controls-page hidden">
        <h2>‚öôÔ∏è Configure Your Test</h2>
        <div class="input-section">
            <h3>üìù Number of Questions</h3>
            <div class="input-group">
                <input type="range" id="questionSlider" min="1" max="50" value="25" oninput="updateQuestionCount()">
                <div class="value-display" id="questionDisplay">25</div>
                <label>Questions (1‚Äì50)</label>
            </div>
        </div>
        <div class="input-section">
            <h3>‚è±Ô∏è Time Limit</h3>
            <div class="input-group">
                <input type="range" id="timerSlider" min="1" max="120" value="30" oninput="updateTimerCount()">
                <div class="value-display" id="timerDisplay">30</div>
                <label>Minutes (1‚Äì120)</label>
            </div>
        </div>
        <button class="btn btn-primary" onclick="startQuiz()" style="padding:1.2rem 3rem;font-size:1.2rem;">Start Test ‚Üí</button>
        <br>
        <button class="btn btn-back" onclick="backToChapters()">‚Üê Back</button>
    </div>

    <!-- CUSTOM BUILDER -->
    <div id="customBuilderPage" class="custom-builder hidden">
        <h2 style="text-align:center;font-size:2.2rem;margin-bottom:2rem;">‚ö° Custom Test Builder</h2>
        <div id="builderSections"></div>
        <div class="input-section">
            <h3>üìù Configure Test</h3>
            <div class="input-group">
                <label>Questions per chapter:</label>
                <input type="range" id="customQuestionSlider" min="1" max="50" value="25" oninput="updateCustomQuestion()">
                <div class="value-display" id="customQuestionDisplay">25</div>
            </div>
            <div class="input-group" style="margin-top:1rem;">
                <label>Time limit (minutes):</label>
                <input type="range" id="customTimerSlider" min="1" max="120" value="30" oninput="updateCustomTimer()">
                <div class="value-display" id="customTimerDisplay">30</div>
            </div>
            <div class="selected-count" id="selectedCount">No chapters selected</div>
        </div>
        <div style="text-align:center">
            <button class="btn btn-primary" id="buildTestBtn" onclick="startCustomTest()" disabled style="padding:1.2rem 3rem;font-size:1.2rem;">Build & Start Test ‚Üí</button>
            <br><button class="btn btn-back" onclick="backToHome()">‚Üê Back to Home</button>
        </div>
    </div>

    <!-- QUIZ -->
    <div id="quizPage" class="hidden">
        <div class="quiz-container">
            <div class="quiz-header">
                <div class="quiz-info">Q <span id="currentQ">1</span>/<span id="totalQ">25</span></div>
                <div class="timer-display">‚è±Ô∏è <span id="timeLeft">30:00</span></div>
                <div class="score-display">Score: <span id="currentScore">0</span></div>
            </div>
            <div class="question-card">
                <div class="q-timer-label">
                    <span>Time on this question</span>
                    <span id="qTimerLabel">0s</span>
                </div>
                <div class="q-timer-bar-wrap">
                    <div class="q-timer-bar" id="qTimerBar"></div>
                </div>
                <div class="paused-banner hidden" id="pausedBanner">‚è∏ Timer paused ‚Äî reading explanation. Click "Next Question" to resume.</div>
                <div class="question-text" id="questionText"></div>
                <div class="options" id="optionsContainer"></div>
                <div id="explanation" class="explanation hidden"></div>
                <div class="quiz-buttons">
                    <button class="btn btn-prev hidden" id="prevBtn">‚Üê Previous</button>
                    <button class="btn btn-submit" id="submitBtn" disabled>Submit Answer</button>
                    <button class="btn btn-next hidden" id="nextBtn">Next Question ‚Üí</button>
                </div>
            </div>

            <!-- REVIEW PANEL -->
            <div class="review-panel">
                <h3>üìã Question Review Panel</h3>
                <div class="review-grid" id="reviewGrid"></div>
                <div style="margin-top:1rem;font-size:0.85rem;color:#64748b;display:flex;gap:1.2rem;flex-wrap:wrap;">
                    <span>üü¢ Correct</span>
                    <span>üî¥ Incorrect</span>
                    <span>üü° Skipped/Unanswered</span>
                    <span>üü£ Reviewing</span>
                    <span style="color:#3b82f6;font-weight:600;">Border = Current</span>
                </div>
            </div>
        </div>
    </div>

    <!-- RESULTS -->
    <div id="resultsPage" class="hidden">
        <div class="results-container">
            <h2>üéâ Test Complete!</h2>
            <div class="final-score" id="finalScore">0</div>
            <div style="max-width:350px;margin:2rem auto;">
                <canvas id="resultsChart"></canvas>
            </div>
            <div class="score-breakdown">
                <div class="score-item">
                    <h3>Correct</h3>
                    <p id="correctCount" style="color:#22c55e;">0</p>
                </div>
                <div class="score-item">
                    <h3>Incorrect</h3>
                    <p id="incorrectCount" style="color:#ef4444;">0</p>
                </div>
                <div class="score-item">
                    <h3>Unanswered</h3>
                    <p id="unansweredCount" style="color:#f59e0b;">0</p>
                </div>
                <div class="score-item">
                    <h3>Total</h3>
                    <p id="totalQuestionsResult">0</p>
                </div>
                <div class="score-item">
                    <h3>Avg Time / Q</h3>
                    <p id="avgTimeResult" style="color:#6366f1;">0s</p>
                </div>
            </div>
            <p id="resultMessage" style="font-size:1.3rem;color:#94a3b8;margin:2rem 0;font-weight:500;"></p>
            <button class="btn btn-primary" onclick="restartQuiz()" style="padding:1.2rem 3rem;font-size:1.2rem;">Back to Home</button>
        </div>

        <!-- FULL QUESTION REVIEW -->
        <div style="max-width:900px;margin:2.5rem auto 0;">
            <h2 style="color:#f1f5f9;font-size:1.8rem;margin-bottom:1.5rem;text-align:center;">üìù Full Question Review</h2>

            <!-- Filter tabs -->
            <div style="display:flex;gap:0.8rem;margin-bottom:1.5rem;flex-wrap:wrap;justify-content:center;">
                <button class="review-filter-btn active" id="filterAll" onclick="filterReview('all')">All Questions</button>
                <button class="review-filter-btn" id="filterCorrect" onclick="filterReview('correct')">‚úÖ Correct</button>
                <button class="review-filter-btn" id="filterIncorrect" onclick="filterReview('incorrect')">‚ùå Incorrect</button>
                <button class="review-filter-btn" id="filterUnanswered" onclick="filterReview('unanswered')">‚è≠ Unanswered</button>
            </div>

            <div id="fullReviewContainer"></div>
        </div>
    </div>

</div><!-- /container -->

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// ================================================================
// TOPICS & CHAPTERS
// ================================================================
const topicsData = {
    diversity: {
        name: 'Diversity in Living World',
        chapters: [
            {id:'living_world', name:'Living World'},
            {id:'biological_classification', name:'Biological Classification'},
            {id:'plant_kingdom', name:'Plant Kingdom'},
            {id:'animal_kingdom', name:'Animal Kingdom'}
        ]
    },
    structural: {
        name: 'Structural Organisation',
        chapters: [
            {id:'morphology_flowering', name:'Morphology of Flowering Plants'},
            {id:'anatomy_flowering', name:'Anatomy of Flowering Plants'},
            {id:'structural_animals', name:'Structural Organization in Animals'}
        ]
    },
    cell: {
        name: 'Cell Structure & Function',
        chapters: [
            {id:'cell_unit', name:'Cell: The Unit of Life'},
            {id:'cell_cycle', name:'Cell Cycle and Cell Division'},
            {id:'biomolecules', name:'Biomolecules'}
        ]
    },
    plant_physiology: {
        name: 'Plant Physiology',
        chapters: [
            {id:'photosynthesis', name:'Photosynthesis in Higher Plants'},
            {id:'respiration_plants', name:'Respiration in Plants'},
            {id:'plant_growth', name:'Plant Growth and Development'}
        ]
    },
    human_physiology: {
        name: 'Human Physiology',
        chapters: [
            {id:'breathing', name:'Breathing and Exchange of Gases'},
            {id:'circulation', name:'Body Fluids and Circulation'},
            {id:'excretion', name:'Excretory Products and Elimination'},
            {id:'locomotion', name:'Locomotion and Movement'},
            {id:'neural', name:'Neural Control and Coordination'},
            {id:'chemical_coord', name:'Chemical Coordination and Regulation'}
        ]
    },
    reproduction: {
        name: 'Reproduction',
        chapters: [
            {id:'sexual_flowering', name:'Sexual Reproduction in Flowering Plants'},
            {id:'human_reproduction', name:'Human Reproduction'},
            {id:'reproductive_health', name:'Reproductive Health'}
        ]
    },
    genetics: {
        name: 'Genetics & Evolution',
        chapters: [
            {id:'molecular_basis', name:'Molecular Basis of Inheritance'},
            {id:'inheritance', name:'Principle of Inheritance'},
            {id:'evolution', name:'Evolution'}
        ]
    },
    welfare: {
        name: 'Biology & Human Welfare',
        chapters: [
            {id:'health_disease', name:'Human Health and Disease'},
            {id:'microbes_welfare', name:'Microbes in Human Welfare'}
        ]
    },
    biotech: {
        name: 'Biotechnology',
        chapters: [
            {id:'biotech_principles', name:'Biotechnology Principles and Processes'},
            {id:'biotech_applications', name:'Applications of Biotechnology'}
        ]
    },
    ecology: {
        name: 'Ecology',
        chapters: [
            {id:'organisms_population', name:'Organisms and Population'},
            {id:'ecosystem', name:'Ecosystem'},
            {id:'biodiversity', name:'Biodiversity'}
        ]
    }
};

// ================================================================
// QUESTION BANK
// Each entry: { question, options:[A,B,C,D], correct:0-3, explanation }
// ================================================================
const questionBank = {
    living_world: [],
    biological_classification: [],
    plant_kingdom: [],
    animal_kingdom: [],
    morphology_flowering: [],
    anatomy_flowering: [],
    structural_animals: [],
    cell_unit: [
        {
            question: "Which of the following helps in cell division in animals?",
            options: ["Mesosome", "Centromere", "Centriole", "Cell plate"],
            correct: 2,
            explanation: "Centrioles help in cell division in animals by forming the spindle apparatus. Cell plate occurs in plants and not animals. Mesosomes occur in prokaryotes and not in animals. Centromere is a part of the chromosome but doesn't directly drive cell division."
        },
        {
            question: "Which of the following doesn't come under the gross physiological processes performed inside the cell?",
            options: ["Recognition", "Memory", "Protein synthesis", "Defense"],
            correct: 2,
            explanation: "While protein synthesis does occur inside a cell, it doesn't come under the gross physiological processes performed by the cell. The gross physiological processes include recognition, memory, defense, etc."
        },
        {
            question: "G.N. Ramachandran's models helped solve the structure of which of the following?",
            options: ["Protein", "DNA", "Collagen", "Cell membrane"],
            correct: 2,
            explanation: "G.N. Ramachandran's models helped solve the structure of collagen. (Reference: NCERT page 86, last line of intro.)"
        },
        {
            question: "Which of the following regarding the mitochondria is true?\n(A) They are the site of glycolysis.\n(B) They are the primary site of protein synthesis.\n(C) They are double membrane bound organelles filled with a dense heterogenous fluid called the matrix.\n(D) They contain their own DNA.\n(E) They divide mostly by binary fission.",
            options: ["(A), (B), (D) and (E)", "(A), (C) and (E)", "(A) and (E)", "(D) and (E)"],
            correct: 3,
            explanation: "Only (D) and (E) are correct. The primary site of protein synthesis is ribosomes, not mitochondria. Glycolysis occurs in the cytoplasm, not mitochondria. The matrix is homogenous, not heterogenous."
        },
        {
            question: "Which of the following scientist said that all plants are made up of cells and its products?",
            options: ["Adolf Virchow", "Theodore Schwann", "Mathias Schleiden", "Robert Brown"],
            correct: 2,
            explanation: "Mathias Schleiden stated that all plants are made up of cells and its products. (Reference: NCERT page 88, first paragraph.)"
        },
        {
            question: "Reserve materials in prokaryotic cells are:",
            options: [
                "Only found in blue and green bacteria",
                "Stored in the form of inclusion bodies and are not bound by any membrane",
                "Similar/analogous to gas vacuoles in plants",
                "Mostly found in plants and store starch"
            ],
            correct: 1,
            explanation: "Reserve materials in prokaryotic cells are stored in the form of inclusion bodies and are not bound by any membrane. Gas vacuoles are found in blue and green bacteria, not inclusion bodies. They are not similar to vacuoles and are mostly found in prokaryotes, not plants."
        },
        {
            question: "Assertion and Reason ‚Äî choose the correct option:\n(A) All living organisms are made up of cells and its products.\n(R) Rudolf Virchow first concluded that all cells arise from pre-existing cells (Omnis cellula-e-cellula) by the process of binary fission.",
            options: [
                "Both statements are correct and (R) correctly explains (A)",
                "Both statements are correct but (R) doesn't explain (A)",
                "(A) is true but (R) is false",
                "(A) is false but (R) is true"
            ],
            correct: 2,
            explanation: "(A) is true but (R) is false. Rudolf Virchow did conclude that all cells arise from pre-existing cells, however cells do not use binary fission ‚Äî they use mitosis or meiosis."
        },
        {
            question: "Bacteria can be classified on the basis of differences in the?",
            options: ["Cell wall", "Plasma membrane", "Nuclear membrane", "Cell envelope"],
            correct: 3,
            explanation: "Bacteria are classified on the basis of differences in the cell envelope. (Reference: NCERT page 90, near the end of the 2nd paragraph.)"
        },
        {
            question: "Which of the following is NOT a function of the mesosome?",
            options: ["Respiration", "Increasing the enzymatic contents", "Cell wall formation", "Locomotion"],
            correct: 3,
            explanation: "Locomotion is not a function of the mesosome. Mesosomes help in respiration, increasing enzymatic content, and cell wall formation. Locomotion is carried out by flagella. (Reference: NCERT page 91, first paragraph.)"
        },
        {
            question: "Assertion and Reason ‚Äî choose the correct option:\n(A) Bacterial cells may be motile or non-motile.\n(R) The bacterial motility depends on the presence or absence of flagella.",
            options: [
                "Both statements are true and (R) explains (A) correctly",
                "Both statements are true but (R) doesn't explain (A) correctly",
                "(A) is true but (R) is false",
                "Both (A) and (R) are false"
            ],
            correct: 0,
            explanation: "Both statements are true and the reason correctly explains the assertion. Bacterial motility does depend on the presence or absence of flagella. (Reference: NCERT page 91, end of 1st paragraph.)"
        },
        {
            question: "Which of the following statements is correct?",
            options: [
                "Most prokaryotes have a simple cell envelope",
                "The cell wall in bacteria can help in interaction with the outside world",
                "The cell envelope is tightly bound where the outermost is cell wall followed by glycocalyx and cell membrane as the innermost layer",
                "Each layer of the cell envelope performs distinct functions but act together as a protective unit"
            ],
            correct: 3,
            explanation: "Each layer of the cell envelope performs distinct functions but acts together as a protective unit. Most prokaryotes have a complex, not simple, cell envelope. The glycocalyx is the outermost layer, followed by the cell wall, then the cell membrane."
        },
        {
            question: "Which of the following regarding the cytoplasm is false?",
            options: [
                "It is present in both eukaryotes and prokaryotes",
                "It is also called the main arena of cellular activities",
                "It is also found in both plants and animals",
                "Ribosomes are only found in the cytoplasm"
            ],
            correct: 3,
            explanation: "Ribosomes are not only found in the cytoplasm ‚Äî they are also found within the mitochondria, chloroplasts, and on the rough ER. (Reference: NCERT page 88, near 2nd paragraph, last line.)"
        },
        {
            question: "Which of the following is different in prokaryotes and eukaryotes?",
            options: ["Cytoplasm", "70S ribosomes", "Rate of replication", "Genetic material"],
            correct: 2,
            explanation: "The rate of replication is different ‚Äî prokaryotes multiply more rapidly compared to eukaryotes. Both can have 70S ribosomes (prokaryotes always; eukaryotes in organelles). Both have genetic material and cytoplasm."
        },
        {
            question: "Which of the following cells played a major role in understanding the structure of the plasma membrane when electron microscopes were discovered in 1950?",
            options: ["Red blood cells", "Neurons", "Most eukaryotic cells", "Columnar epithelial cells"],
            correct: 0,
            explanation: "Red blood cells played a major role in understanding the structure of the plasma membrane. (Reference: NCERT page 93, first paragraph.)"
        },
        {
            question: "How are lipids arranged in the cell membrane?",
            options: [
                "The head is polar and present on the outer side, while the tail is hydrophilic and present on the inner side",
                "The head is non-polar and present on the outer side, while the tail is hydrophobic and present on the inner side",
                "The head is polar and present on the inner side, while the tail is hydrophobic and present on the outer side",
                "The head is polar and present towards the outer side, while the tail is hydrophobic and present towards the inner side"
            ],
            correct: 3,
            explanation: "The polar heads of lipids face outward (towards the aqueous environment) and the hydrophobic tails face inward. (Reference: NCERT page 93, mid paragraph.)"
        },
        {
            question: "How are proteins classified in the cell membrane?",
            options: [
                "On the basis of ease of extraction",
                "On the presence or absence of a phosphate group",
                "On the shape",
                "Depending on their mass"
            ],
            correct: 0,
            explanation: "Proteins in the cell membrane are classified on the basis of ease of extraction ‚Äî giving rise to peripheral and integral proteins. (Reference: NCERT page 93, end paragraph.)"
        },
        {
            question: "Fluidity can also be called:",
            options: [
                "The quality of proteins inside the cell membrane",
                "The semi-permeable nature of the cell membrane",
                "The ability to move within the membrane",
                "The hydrophobic nature of the lipids"
            ],
            correct: 2,
            explanation: "Fluidity refers to the ability of membrane components to move within the membrane. (Reference: NCERT page 94, around the end of first paragraph.)"
        },
        {
            question: "The fluid nature of the cell membrane does NOT help which of the following functions?\n(A) Cell growth\n(B) Secretion\n(C) Cell division\n(D) Formation of intercellular junctions\n(E) Respiration",
            options: ["(A), (B), (C) and (D)", "(B), (D) and (E)", "(C) and (D) only", "None of the above"],
            correct: 3,
            explanation: "The fluid nature of the cell membrane helps in ALL of these functions ‚Äî cell growth, secretion, cell division, and formation of intercellular junctions. None of them are excluded. (Reference: NCERT page 94, 2nd paragraph.)"
        },
        {
            question: "Which of the following is correct regarding polar molecules and their movement through the cell membrane?",
            options: [
                "They can move through the cell membrane by simple diffusion",
                "They can move through the cell membrane with the help of a carrier protein",
                "They cannot move through the cell membrane at all",
                "They can move through the cell membrane against the concentration gradient"
            ],
            correct: 1,
            explanation: "Polar molecules require a carrier protein to move through the cell membrane. Simple diffusion is for neutral solutes. Moving against the concentration gradient applies to ions. (Reference: NCERT page 94, 2nd paragraph.)"
        },
        {
            question: "The middle lamella is mainly composed of?",
            options: ["Calcium pectate", "Magnesium pectate", "Chitin", "Hemicellulose"],
            correct: 0,
            explanation: "The middle lamella is mainly composed of calcium pectate, which helps in holding adjacent cells together. (Reference: NCERT page 94, under the cell wall sub-heading.)"
        },
        {
            question: "Which of the following is true about the cell wall?",
            options: [
                "The primary cell wall is present near the outer side of the matured cell",
                "The cell wall may be traversed by middle lamella which connects the nucleus of both cells",
                "The secondary cell wall is present on the inner side towards the cell membrane",
                "Cell wall can help in infection and damage"
            ],
            correct: 2,
            explanation: "The secondary cell wall is present on the inner side, towards the cell membrane. The primary cell wall is usually absent in matured cells. The middle lamella connects adjacent cells through the cytoplasm, not the nucleus. Cell wall provides protection against damage and infection, not cause it."
        },
        {
            question: "Which of the following is NOT a part of the endomembrane system?",
            options: ["Lysosomes", "Mitochondria", "Vacuoles", "Golgi complex"],
            correct: 1,
            explanation: "Mitochondria are not a part of the endomembrane system because their functions are not coordinated with the ER, Golgi, lysosomes, and vacuoles that form the endomembrane system."
        },
        {
            question: "The ER divides the intracellular space into 2 parts mainly called as:",
            options: [
                "Intraluminal (inside ER) and luminal (outside ER)",
                "Luminal (inside ER) and intraluminal (outside ER)",
                "Luminal (inside ER) and extraluminal (outside ER)",
                "Intraluminal (inside ER) and extraluminal (outside ER)"
            ],
            correct: 2,
            explanation: "The ER divides the intracellular space into luminal (inside the ER) and extraluminal (outside the ER) compartments. (Reference: NCERT page 95, 2nd paragraph.)"
        },
        {
            question: "Which of the following is the site for lipid synthesis?",
            options: ["RER", "Ribosome", "SER", "Nucleus"],
            correct: 2,
            explanation: "The Smooth Endoplasmic Reticulum (SER) is the site for lipid synthesis. (Reference: NCERT page 95, near the end of 3rd paragraph.)"
        },
        {
            question: "Which of the following is incorrect regarding Golgi bodies?",
            options: [
                "They are spherical in shape",
                "The cisternae of Golgi bodies are stacked parallel to each other",
                "The cis and trans face function very differently",
                "The vesicles fuse with cis face and move towards the trans face or the maturing face"
            ],
            correct: 0,
            explanation: "Golgi bodies are disc-shaped, not spherical. (Reference: NCERT page 95, near the end.)"
        },
        {
            question: "Lysosomes are rich in many hydrolytic enzymes. Which of the following is NOT present in a lysosome?",
            options: ["Lipase", "Nucleases", "Proteases", "HCl"],
            correct: 3,
            explanation: "HCl is not present in lysosomes. Lysosomes contain hydrolytic enzymes like lipases, proteases, and nucleases (capable of digesting nucleic acids). (Reference: NCERT page 96, under the lysosome section.)"
        },
        {
            question: "Which of the following statements is incorrect regarding vacuoles?",
            options: [
                "Concentration gradient is higher in cytoplasm compared to vacuoles",
                "Contractile vacuole helps in osmoregulation in Amoeba",
                "Vacuoles contain mainly useless products of the cell",
                "Tonoplast facilitates the transport of a number of ions into the vacuole"
            ],
            correct: 0,
            explanation: "The concentration gradient is actually higher in vacuoles compared to the cytoplasm, not the other way around. (Reference: NCERT page 96, vacuole section.)"
        },
        {
            question: "Which of the following cannot be the shape of mitochondria?",
            options: ["Rod shaped", "Cylindrical", "Sausage shaped", "Bean shaped"],
            correct: 3,
            explanation: "Mitochondria can be cylindrical, rod-shaped, or sausage-shaped but NOT bean-shaped. Bean shape is not a described shape of mitochondria."
        },
        {
            question: "Which of the following is incorrect regarding the mitochondria?",
            options: [
                "They contain multiple infoldings called cristae",
                "The two membranes contain their own enzymes with similar or different functions",
                "They contain double circular DNA molecule and a few RNA molecules",
                "They mostly divide by binary fission"
            ],
            correct: 2,
            explanation: "Mitochondria contain a single circular DNA molecule, not double. They do contain a few RNA molecules, and do divide by binary fission."
        },
        {
            question: "Plastids are found in which of the following?",
            options: ["Plants only", "Euglenoids only", "Both plants and euglenoids", "Animals"],
            correct: 2,
            explanation: "Plastids are found in both plants and euglenoids. (Reference: NCERT page 97, under the plastid section.)"
        },
        {
            question: "Match the following correctly: (i) Chromoplast, (ii) Aleuroplast, (iii) Elaioplast, (iv) Amyloplast ‚Äî (a) Oil and fats, (b) Pigments, (c) Proteins, (d) Starch",
            options: [
                "(i)-(b), (ii)-(c), (iii)-(d), (iv)-(a)",
                "(i)-(b), (ii)-(c), (iii)-(a), (iv)-(d)",
                "(i)-(c), (ii)-(b), (iii)-(d), (iv)-(d)",
                "(i)-(b), (ii)-(a), (iii)-(c), (iv)-(d)"
            ],
            correct: 1,
            explanation: "Chromoplast stores pigments, Aleuroplast stores proteins, Elaioplast stores oils and fats, Amyloplast stores starch. (Reference: NCERT page 98.)"
        },
        {
            question: "The length of chloroplast in micrometers is:",
            options: ["6‚Äì8", "7‚Äì11", "0.6‚Äì1.2", "5‚Äì10"],
            correct: 3,
            explanation: "The length of chloroplast is 5‚Äì10 micrometers. (Reference: NCERT page 98, mid paragraph.)"
        },
        {
            question: "Which of the following regarding the chloroplast is incorrect?",
            options: [
                "They contain their own double stranded DNA",
                "Stroma of chloroplast can help in the synthesis of carbohydrates and proteins",
                "Chloroplasts usually have slightly smaller ribosomes compared to the cytoplasm",
                "The number of chloroplasts varies from 1‚Äì50 depending on the type of cell"
            ],
            correct: 3,
            explanation: "The number of chloroplasts varies from 1‚Äì40 per cell, not 1‚Äì50. (Reference: NCERT page 98.)"
        },
        {
            question: "Ribosomes were first discovered by?",
            options: ["Camillo Golgi", "Mendel", "George Palade", "Flemming"],
            correct: 2,
            explanation: "Ribosomes were first discovered by George Palade. (Reference: NCERT page 98, under the ribosome section.)"
        },
        {
            question: "Cytoskeleton is made up of?",
            options: ["Protein", "Ribosomes", "Chitin", "Tubulin proteins"],
            correct: 0,
            explanation: "The cytoskeleton is made up of protein filaments. (Reference: NCERT page 98, near the cytoskeleton section.)"
        },
        {
            question: "Which of the following regarding cilia and flagella is incorrect?",
            options: [
                "Cilia are small structures which work like oars",
                "Flagella is similar in structure in eukaryotes and prokaryotes",
                "They both have a core called axoneme which possesses a number of microtubules",
                "Both share a common origin"
            ],
            correct: 1,
            explanation: "Flagella in eukaryotes and prokaryotes are structurally different. The eukaryotic flagellum has a 9+2 arrangement of microtubules, whereas prokaryotic flagella are made of flagellin protein."
        },
        {
            question: "Which of the following have a cartwheel-like organisation?",
            options: ["Centrosome", "Centrioles", "Both centrosome and centrioles", "Cilia and flagella"],
            correct: 1,
            explanation: "Centrioles have a cartwheel-like organisation. Centrioles are the structural components found within the centrosome."
        },
        {
            question: "Nucleus was first discovered by?",
            options: ["Robert Hooke", "Flemming", "Robert Brown", "George Palade"],
            correct: 2,
            explanation: "The nucleus was first discovered by Robert Brown. (Reference: NCERT page 100, under the nucleus section.)"
        },
        {
            question: "The perinuclear space measured in nanometers is around:",
            options: ["10‚Äì20", "25‚Äì100", "50‚Äì100", "10‚Äì50"],
            correct: 3,
            explanation: "The perinuclear space is approximately 10‚Äì50 nm. (Reference: NCERT page 100, nucleus section.)"
        },
        {
            question: "Nuclear pores present in the nucleus provide passage for which materials?",
            options: ["RNA and DNA", "Chromosomes and RNA", "Proteins and RNA", "DNA and proteins"],
            correct: 2,
            explanation: "Nuclear pores provide passage for proteins (moving into the nucleus) and RNA (moving out of the nucleus). (Reference: NCERT page 100, near the end.)"
        },
        {
            question: "Which of the following is NOT true regarding the nucleolus?",
            options: [
                "Larger and more numerous nucleoli are present in cells which carry out protein synthesis",
                "They are spherical in shape",
                "They are usually single membrane bound organelles",
                "It is an active site for RNA synthesis"
            ],
            correct: 3,
            explanation: "The nucleolus is an active site for RNA synthesis (ribosomal RNA). It is NOT membrane bound ‚Äî option 3 is incorrect. Options 1 and 2 are partially correct but not fully accurate."
        },
        {
            question: "Chromosomes are differentiated on the basis of?",
            options: [
                "Position of kinetochore",
                "Position of centromere",
                "Type of proteins present in the chromosome",
                "Length of the DNA present in them"
            ],
            correct: 1,
            explanation: "Chromosomes are differentiated on the basis of the position of the centromere. (Reference: NCERT page 101, mid paragraph.)"
        },
        {
            question: "Microbodies are:",
            options: [
                "Double membrane bound minute vesicles present in animal cells",
                "Not bounded by any membrane and contain enzymes",
                "Specifically found in plant cells",
                "Minute membrane bound vesicles present in both plants and animals and contain various enzymes"
            ],
            correct: 3,
            explanation: "Microbodies are minute membrane bound vesicles present in both plant and animal cells and contain various enzymes. (Reference: NCERT page 102, end of chapter.)"
        },
        {
            question: "The basal body of cilia and flagella is formed by?",
            options: ["Microtubules", "Cytoskeleton", "Ribosome", "Centrosome and centriole"],
            correct: 3,
            explanation: "The basal body of cilia and flagella is formed by the centrosome and centriole. (Reference: NCERT page 102, near the summary.)"
        },
        {
            question: "What percent of proteins and lipids are present in the plasma membrane?",
            options: [
                "52% protein, 48% lipids",
                "52% lipid, 48% proteins",
                "52% protein, 40% lipids",
                "52% lipids and 40% proteins"
            ],
            correct: 2,
            explanation: "The plasma membrane is composed of approximately 52% protein and 40% lipids. (Reference: NCERT page 93, end of cell membrane section.)"
        },
        {
            question: "Which of the following is one of the longest cells?",
            options: ["Nerve cells", "Neurons", "Columnar cells", "Blood cells"],
            correct: 0,
            explanation: "Nerve cells (also known as neurons) are one of the longest cells in the body. 'Nerve cells' and 'neurons' refer to the same thing, but option 1 is the more complete answer as given in NCERT."
        },
        {
            question: "What is the length of the smallest cell in micrometers?",
            options: ["3", "0.03", "0.5", "0.3"],
            correct: 3,
            explanation: "The smallest cells are approximately 0.3 micrometers in length (PPLO ‚Äì Pleuro Pneumonia Like Organisms). (Reference: NCERT page 88, near the end.)"
        },
        {
            question: "Why is the cell considered the unit of all living organisms?",
            options: [
                "Because the first living organisms were prokaryotes",
                "Without a cell there is no life",
                "Anything less than one single cell doesn't ensure independent living",
                "Cells divide by meiosis"
            ],
            correct: 2,
            explanation: "The cell is considered the unit of life because anything less than one single cell cannot ensure independent living. (Reference: NCERT page 87.)"
        },
        {
            question: "The smallest living organisms are?",
            options: ["PPLO", "Bacterial cells", "Viruses", "Parasites"],
            correct: 0,
            explanation: "The smallest living organisms are PPLO (Pleuro Pneumonia Like Organisms), also known as Mycoplasma. (Reference: NCERT page 89.)"
        },
        {
            question: "Which of the following shapes is NOT a shape of a cell?",
            options: ["Cubical", "Cup shaped", "Irregular", "Polygonal"],
            correct: 1,
            explanation: "Cells can be disc-shaped, not cup-shaped. RBCs for example are biconcave disc-shaped. Cup-shaped is not a described shape of animal or plant cells."
        },
        {
            question: "The antibiotic resistance of bacteria is due to?",
            options: ["Tough glycocalyx layer", "Plasmid", "Rigid cell wall", "Random mutation"],
            correct: 1,
            explanation: "Antibiotic resistance in bacteria is due to plasmids, which carry resistance genes. (Reference: NCERT page 90, mid paragraph.)"
        }
    ],
    cell_cycle: [],
    biomolecules: [],
    photosynthesis: [],
    respiration_plants: [],
    plant_growth: [],
    breathing: [],
    circulation: [],
    excretion: [],
    locomotion: [],
    neural: [],
    chemical_coord: [],
    sexual_flowering: [],
    human_reproduction: [],
    reproductive_health: [],
    molecular_basis: [],
    inheritance: [],
    evolution: [],
    health_disease: [],
    microbes_welfare: [],
    biotech_principles: [],
    biotech_applications: [],
    organisms_population: [],
    ecosystem: [],
    biodiversity: []
};

// ================================================================
// STATE
// ================================================================
let currentTopic = '', currentChapter = '', currentQuestions = [];
let currentQIndex = 0, score = 0, correct = 0, incorrect = 0, unanswered = 0;
let selectedAns = null, answered = false;
let timerInterval = null, timeRemaining = 0;
let questionCount = 25, timerMinutes = 30;

// Per-question timer
let qTimerInterval = null;
let qTimeSpent = 0;
let qTimerMax = 120;
let qTimePaused = false;
let questionTimes = [];
let questionStatus = []; // 'unanswered' | 'correct' | 'incorrect' | 'reviewing'
let userAnswers = [];    // stores which option index the user picked (-1 = unanswered)

// ================================================================
// GLOBAL TIMER
// ================================================================
function stopTimer() {
    if (timerInterval !== null) { clearInterval(timerInterval); timerInterval = null; }
}

function startTimer() {
    stopTimer();
    updateTimerDisplay();
    timerInterval = setInterval(() => {
        timeRemaining--;
        updateTimerDisplay();
        if (timeRemaining <= 0) {
            stopTimer();
            alert('‚è∞ Time Up! Your test is being submitted.');
            showResults();
        }
    }, 1000);
}

function updateTimerDisplay() {
    const m = Math.floor(timeRemaining / 60);
    const s = timeRemaining % 60;
    document.getElementById('timeLeft').textContent = `${m}:${s.toString().padStart(2, '0')}`;
}

// ================================================================
// PER-QUESTION TIMER
// ================================================================
function stopQTimer() {
    if (qTimerInterval !== null) { clearInterval(qTimerInterval); qTimerInterval = null; }
}

function startQTimer() {
    stopQTimer();
    qTimePaused = false;
    updateQTimerDisplay();
    qTimerInterval = setInterval(() => {
        if (!qTimePaused) { qTimeSpent++; updateQTimerDisplay(); }
    }, 1000);
}

function pauseQTimer() {
    qTimePaused = true;
    stopTimer(); // pause global timer while reading explanation
    document.getElementById('pausedBanner').classList.remove('hidden');
}

function resumeQTimer() {
    qTimePaused = false;
    document.getElementById('pausedBanner').classList.add('hidden');
    startTimer(); // resume global timer
}

function updateQTimerDisplay() {
    const pct = Math.min((qTimeSpent / qTimerMax) * 100, 100);
    const bar = document.getElementById('qTimerBar');
    bar.style.width = pct + '%';
    bar.className = 'q-timer-bar' + (pct > 80 ? ' danger' : pct > 50 ? ' warning' : '');
    document.getElementById('qTimerLabel').textContent = qTimeSpent + 's';
}

function saveQTime() {
    questionTimes[currentQIndex] = qTimeSpent;
}

// ================================================================
// PAGE MANAGEMENT
// ================================================================
const allPages = ['homePage','chapterPage','controlsPage','customBuilderPage','quizPage','resultsPage'];

function showPage(pageId) {
    allPages.forEach(id => document.getElementById(id).classList.add('hidden'));
    document.getElementById(pageId).classList.remove('hidden');
}

function backToHome() { stopTimer(); stopQTimer(); showPage('homePage'); }
function backToChapters() { stopTimer(); stopQTimer(); showPage('chapterPage'); }

// ================================================================
// CHAPTER SELECTION
// ================================================================
function showChapters(topic) {
    currentTopic = topic;
    const data = topicsData[topic];
    document.getElementById('chapterTitle').textContent = data.name;
    const grid = document.getElementById('chapterGrid');
    grid.innerHTML = '';
    data.chapters.forEach(ch => {
        const qCount = (questionBank[ch.id] || []).length;
        const card = document.createElement('div');
        card.className = 'chapter-card' + (qCount === 0 ? ' no-questions' : '');
        card.innerHTML = `<h3>${ch.name}</h3><p>${qCount} Question${qCount !== 1 ? 's' : ''} Available</p>`;
        card.onclick = qCount > 0
            ? () => selectChapter(ch.id, qCount)
            : () => alert('No questions added for this chapter yet. Check back soon!');
        grid.appendChild(card);
    });
    showPage('chapterPage');
}

function selectChapter(chapterId, qCount) {
    currentChapter = chapterId;
    const slider = document.getElementById('questionSlider');
    slider.max = Math.min(50, qCount);
    slider.value = Math.min(25, qCount);
    updateQuestionCount();
    document.getElementById('timerSlider').value = 30;
    updateTimerCount();
    showPage('controlsPage');
}

// ================================================================
// CUSTOM BUILDER
// ================================================================
function showCustomBuilder() {
    const container = document.getElementById('builderSections');
    container.innerHTML = '';
    Object.keys(topicsData).forEach(topicKey => {
        const topic = topicsData[topicKey];
        const section = document.createElement('div');
        section.className = 'builder-section';
        section.innerHTML = `<h3>${topic.name}</h3>`;
        topic.chapters.forEach(ch => {
            const qCount = (questionBank[ch.id] || []).length;
            const wrap = document.createElement('div');
            wrap.className = 'chapter-checkbox';
            wrap.innerHTML = `<input type="checkbox" id="cb_${ch.id}" ${qCount === 0 ? 'disabled' : ''}>
                <label for="cb_${ch.id}">${ch.name} <span style="color:#94a3b8">(${qCount}Q)</span></label>`;
            wrap.onclick = (e) => {
                if (e.target.tagName !== 'INPUT') {
                    const cb = document.getElementById(`cb_${ch.id}`);
                    if (!cb.disabled) cb.click();
                }
            };
            section.appendChild(wrap);
        });
        container.appendChild(section);
    });
    document.querySelectorAll('#builderSections input[type="checkbox"]').forEach(cb => {
        cb.addEventListener('change', updateCustomCount);
    });
    showPage('customBuilderPage');
    updateCustomCount();
}

function updateCustomCount() {
    const selected = Array.from(document.querySelectorAll('#builderSections input:checked'));
    document.getElementById('selectedCount').textContent = selected.length
        ? `${selected.length} chapter(s) selected` : 'No chapters selected';
    document.getElementById('buildTestBtn').disabled = selected.length === 0;
}

// ================================================================
// SLIDER CONTROLS
// ================================================================
function updateQuestionCount() {
    questionCount = parseInt(document.getElementById('questionSlider').value);
    document.getElementById('questionDisplay').textContent = questionCount;
}
function updateTimerCount() {
    timerMinutes = parseInt(document.getElementById('timerSlider').value);
    document.getElementById('timerDisplay').textContent = timerMinutes;
}
function updateCustomQuestion() {
    document.getElementById('customQuestionDisplay').textContent = document.getElementById('customQuestionSlider').value;
}
function updateCustomTimer() {
    document.getElementById('customTimerDisplay').textContent = document.getElementById('customTimerSlider').value;
}

// ================================================================
// START QUIZ
// ================================================================
function startQuiz() {
    timeRemaining = timerMinutes * 60;
    const pool = [...questionBank[currentChapter]].sort(() => Math.random() - 0.5).slice(0, questionCount);
    if (pool.length === 0) { alert('No questions available!'); return; }
    currentQuestions = pool;
    initQuiz();
}

function startCustomTest() {
    const selected = Array.from(document.querySelectorAll('#builderSections input:checked')).map(cb => cb.id.replace('cb_', ''));
    const qPerChapter = parseInt(document.getElementById('customQuestionSlider').value);
    timeRemaining = parseInt(document.getElementById('customTimerSlider').value) * 60;
    currentQuestions = [];
    selected.forEach(chId => {
        const pool = [...(questionBank[chId] || [])].sort(() => Math.random() - 0.5).slice(0, qPerChapter);
        currentQuestions = currentQuestions.concat(pool);
    });
    currentQuestions = currentQuestions.sort(() => Math.random() - 0.5);
    if (currentQuestions.length === 0) { alert('No questions available for selected chapters!'); return; }
    initQuiz();
}

function initQuiz() {
    stopTimer(); stopQTimer();
    qTimePaused = false;
    qTimeSpent = 0;
    currentQIndex = 0;
    score = 0; correct = 0; incorrect = 0; unanswered = 0;
    questionTimes = new Array(currentQuestions.length).fill(0);
    questionStatus = new Array(currentQuestions.length).fill('unanswered');
    userAnswers = new Array(currentQuestions.length).fill(-1);
    document.getElementById('totalQ').textContent = currentQuestions.length;
    document.getElementById('currentScore').textContent = '0';
    document.getElementById('pausedBanner').classList.add('hidden');
    document.getElementById('submitBtn').classList.remove('hidden');
    document.getElementById('submitBtn').disabled = true;
    document.getElementById('nextBtn').classList.add('hidden');
    document.getElementById('prevBtn').classList.add('hidden');
    showPage('quizPage');
    buildReviewGrid();
    startTimer();
    loadQuestion();
}

// ================================================================
// REVIEW PANEL
// ================================================================
function buildReviewGrid() {
    const grid = document.getElementById('reviewGrid');
    grid.innerHTML = '';
    currentQuestions.forEach((_, i) => {
        const btn = document.createElement('button');
        btn.id = `rev-${i}`;
        btn.className = 'review-btn';
        btn.innerHTML = `<span class="q-num">${i + 1}</span><span class="q-time" id="rev-time-${i}">-</span>`;
        btn.onclick = () => jumpToQuestion(i);
        grid.appendChild(btn);
    });
    updateReviewPanel();
}

function updateReviewPanel() {
    currentQuestions.forEach((_, i) => {
        const btn = document.getElementById(`rev-${i}`);
        if (!btn) return;
        const timeEl = document.getElementById(`rev-time-${i}`);
        timeEl.textContent = questionTimes[i] > 0 ? questionTimes[i] + 's' : '-';
        btn.className = 'review-btn';
        const s = questionStatus[i];
        if (s === 'correct') btn.classList.add('correct-q');
        else if (s === 'incorrect') btn.classList.add('incorrect-q');
        else if (s === 'reviewing') btn.classList.add('reviewing');
        else btn.classList.add('skipped-q');
        if (i === currentQIndex) btn.classList.add('current-q');
    });
}

function jumpToQuestion(i) {
    if (i === currentQIndex) return;
    saveQTime();
    if (questionStatus[i] === 'unanswered') questionStatus[i] = 'reviewing';
    currentQIndex = i;
    if (qTimePaused) resumeQTimer();
    loadQuestion();
}

// ================================================================
// QUIZ LOGIC
// ================================================================
function loadQuestion() {
    stopQTimer();
    const q = currentQuestions[currentQIndex];
    document.getElementById('currentQ').textContent = currentQIndex + 1;
    document.getElementById('questionText').innerHTML = q.question.replace(/\n/g, '<br>');

    const opts = document.getElementById('optionsContainer');
    opts.innerHTML = '';
    q.options.forEach((opt, i) => {
        const div = document.createElement('div');
        div.className = 'option';
        div.textContent = opt;
        div.onclick = () => selectOption(i, div);
        opts.appendChild(div);
    });

    document.getElementById('explanation').classList.add('hidden');
    document.getElementById('pausedBanner').classList.add('hidden');
    document.getElementById('submitBtn').classList.remove('hidden');
    document.getElementById('submitBtn').disabled = true;
    document.getElementById('nextBtn').classList.add('hidden');
    document.getElementById('prevBtn').classList.toggle('hidden', currentQIndex === 0);

    selectedAns = null;
    answered = false;

    const status = questionStatus[currentQIndex];
    if (status === 'correct' || status === 'incorrect') {
        restoreAnsweredQuestion();
    } else {
        qTimeSpent = questionTimes[currentQIndex] || 0;
        startQTimer();
    }
    updateReviewPanel();
}

function restoreAnsweredQuestion() {
    answered = true;
    const q = currentQuestions[currentQIndex];
    document.querySelectorAll('.option').forEach((opt, i) => {
        opt.classList.add('disabled');
        if (i === q.correct) opt.classList.add('correct');
    });
    document.getElementById('explanation').innerHTML = `<strong>Explanation:</strong> ${q.explanation}`;
    document.getElementById('explanation').classList.remove('hidden');
    document.getElementById('submitBtn').classList.add('hidden');
    document.getElementById('nextBtn').classList.remove('hidden');
    qTimeSpent = questionTimes[currentQIndex] || 0;
    updateQTimerDisplay();
}

function selectOption(i, el) {
    if (answered) return;
    document.querySelectorAll('.option').forEach(o => o.classList.remove('selected'));
    el.classList.add('selected');
    selectedAns = i;
    document.getElementById('submitBtn').disabled = false;
}

function submitAnswer() {
    if (selectedAns === null || answered) return;
    answered = true;
    saveQTime();
    stopQTimer();
    const q = currentQuestions[currentQIndex];
    document.querySelectorAll('.option').forEach((opt, i) => {
        opt.classList.add('disabled');
        if (i === q.correct) opt.classList.add('correct');
        if (i === selectedAns && selectedAns !== q.correct) opt.classList.add('incorrect');
    });
    if (selectedAns === q.correct) { score += 4; correct++; questionStatus[currentQIndex] = 'correct'; }
    else { score -= 1; incorrect++; questionStatus[currentQIndex] = 'incorrect'; }
    userAnswers[currentQIndex] = selectedAns;
    document.getElementById('currentScore').textContent = score;
    document.getElementById('explanation').innerHTML = `<strong>Explanation:</strong> ${q.explanation}`;
    document.getElementById('explanation').classList.remove('hidden');
    document.getElementById('submitBtn').classList.add('hidden');
    document.getElementById('nextBtn').classList.remove('hidden');
    // Pause both timers while reading explanation
    pauseQTimer();
    updateReviewPanel();
}

function nextQuestion() {
    resumeQTimer(); // restarts global timer
    stopQTimer();
    currentQIndex++;
    if (currentQIndex < currentQuestions.length) loadQuestion();
    else showResults();
}

function prevQuestion() {
    saveQTime();
    if (questionStatus[currentQIndex] === 'unanswered') questionStatus[currentQIndex] = 'unanswered';
    if (qTimePaused) resumeQTimer();
    currentQIndex--;
    if (questionStatus[currentQIndex] === 'unanswered') questionStatus[currentQIndex] = 'reviewing';
    loadQuestion();
}

// ================================================================
// RESULTS
// ================================================================
function showResults() {
    stopTimer(); stopQTimer();
    unanswered = currentQuestions.length - correct - incorrect;
    showPage('resultsPage');
    const pct = currentQuestions.length > 0 ? (correct / currentQuestions.length) * 100 : 0;
    document.getElementById('finalScore').textContent = score;
    document.getElementById('finalScore').className = 'final-score ' +
        (pct >= 90 ? 'excellent' : pct >= 70 ? 'good' : pct >= 50 ? 'average' : 'poor');
    document.getElementById('correctCount').textContent = correct;
    document.getElementById('incorrectCount').textContent = incorrect;
    document.getElementById('unansweredCount').textContent = unanswered;
    document.getElementById('totalQuestionsResult').textContent = currentQuestions.length;
    document.getElementById('resultMessage').textContent =
        pct >= 90 ? 'üåü Outstanding Performance!' :
        pct >= 70 ? 'üí™ Great Job!' :
        pct >= 50 ? 'üìö Good Effort!' : 'üéØ Keep Practicing!';

    const answered_times = questionTimes.filter(t => t > 0);
    const avgTime = answered_times.length > 0
        ? Math.round(answered_times.reduce((a, b) => a + b, 0) / answered_times.length) : 0;
    document.getElementById('avgTimeResult').textContent = avgTime + 's';

    const ctx = document.getElementById('resultsChart').getContext('2d');
    if (window.resultsChartObj) window.resultsChartObj.destroy();
    window.resultsChartObj = new Chart(ctx, {
        type: 'pie',
        data: {
            labels: ['Correct', 'Incorrect', 'Unanswered'],
            datasets: [{
                data: [correct, incorrect, unanswered],
                backgroundColor: ['#22c55e', '#ef4444', '#f59e0b'],
                borderColor: ['#fff','#fff','#fff'],
                borderWidth: 3
            }]
        },
        options: { responsive: true, plugins: { legend: { position: 'bottom' } } }
    });

    buildFullReview('all');
}

// ================================================================
// FULL QUESTION REVIEW
// ================================================================
let currentReviewFilter = 'all';

function buildFullReview(filter) {
    currentReviewFilter = filter;

    // Update active tab
    ['filterAll','filterCorrect','filterIncorrect','filterUnanswered'].forEach(id => {
        document.getElementById(id).classList.remove('active');
    });
    const map = { all: 'filterAll', correct: 'filterCorrect', incorrect: 'filterIncorrect', unanswered: 'filterUnanswered' };
    document.getElementById(map[filter]).classList.add('active');

    const container = document.getElementById('fullReviewContainer');
    container.innerHTML = '';

    currentQuestions.forEach((q, i) => {
        const status = questionStatus[i];
        const userAns = userAnswers[i]; // -1 = unanswered

        // Apply filter
        if (filter === 'correct' && status !== 'correct') return;
        if (filter === 'incorrect' && status !== 'incorrect') return;
        if (filter === 'unanswered' && status !== 'unanswered') return;

        const card = document.createElement('div');
        card.className = `review-q-card review-${status === 'correct' ? 'correct' : status === 'incorrect' ? 'incorrect' : 'unanswered'}`;

        const badge = status === 'correct'
            ? '<span class="review-q-badge badge-correct">‚úÖ Correct</span>'
            : status === 'incorrect'
            ? '<span class="review-q-badge badge-incorrect">‚ùå Incorrect</span>'
            : '<span class="review-q-badge badge-unanswered">‚è≠ Unanswered</span>';

        const timeSpent = questionTimes[i] > 0 ? `${questionTimes[i]}s` : '‚Äî';

        let optionsHTML = q.options.map((opt, oi) => {
            let cls = 'review-option';
            if (oi === q.correct) cls += ' review-opt-correct';
            else if (oi === userAns && userAns !== q.correct) cls += ' review-opt-selected-wrong';
            const label = ['A', 'B', 'C', 'D'][oi];
            return `<div class="${cls}">${label}. ${opt}</div>`;
        }).join('');

        card.innerHTML = `
            <div class="review-q-header">
                <span class="review-q-num">Question ${i + 1} &nbsp;‚Ä¢&nbsp; ‚è± ${timeSpent}</span>
                ${badge}
            </div>
            <div class="review-q-text">${q.question.replace(/\n/g, '<br>')}</div>
            <div class="review-options">${optionsHTML}</div>
            <div class="review-explanation"><strong>üí° Explanation:</strong> ${q.explanation}</div>
        `;

        container.appendChild(card);
    });

    if (container.innerHTML === '') {
        container.innerHTML = `<div style="text-align:center;color:#64748b;padding:2rem;font-size:1.1rem;">No questions in this category.</div>`;
    }
}

function filterReview(filter) {
    buildFullReview(filter);
}

function restartQuiz() {
    stopTimer(); stopQTimer();
    showPage('homePage');
}

// ================================================================
// BUTTON BINDINGS
// ================================================================
document.getElementById('submitBtn').onclick = submitAnswer;
document.getElementById('nextBtn').onclick = nextQuestion;
document.getElementById('prevBtn').onclick = prevQuestion;
</script>
</body>
</html>




